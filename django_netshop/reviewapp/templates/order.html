{% extends 'base.html' %}
{% block title %}
支付页面
{% endblock %}
{% block headerjs %}
    <link rel="stylesheet" type="text/css" href="/static/public.css">
    <link rel="stylesheet" type="text/css" href="/static/proList.css">
{% endblock %}

{% block main %}
    {% load myfilter %}
<div class="order cart mt">
			<!-----------------site------------------->
			<div class="site">
				<p class="wrapper clearfix">
					<span class="fl">订单确认</span>
				</p>
			</div>
			<!-----------------orderCon------------------->
			<div class="orderCon wrapper clearfix">
				<div class="orderL fl">
					<!--------h3---------------->
					<h3>收件信息</h3>
					<!--------addres---------------->

					<div class="addres clearfix">
						<div class="addre fl on">
							<div class="tit clearfix">
								<p class="fl"><span id="name_address">{{ addr.aname }}</span>
									<span class="default">[默认地址]</span>
								</p>
							</div>
							<div class="addCon">
								<p id="address_address">{{ addr.addr }}</p>
								<p id="phone_address">{{ addr.phonenum }}</p>
							</div>
						</div>
					</div>
					<h3>支付方式</h3>
					<!--------way---------------->
					<div class="way clearfix">
						<img class="on" src="/static/way01.jpg" name="alipay">
						<img src="/static/way02.jpg" name="wechat">
						<img src="/static/way03.jpg" name="union">

					</div>

					<!--------dis---------------->

				</div>
				<div class="orderR fr">
					<div class="msg">
						<h3>订单内容</h3>
						<!--------ul---------------->

                    {% if cartlist %}
                        {% for i in cartlist %}
                        <ul class="clearfix" goodsid={{ i.goodsid }} sizeid={{ i.sizeid }} colorid={{ i.colorid }} count={{ i.count }}>
							<li class="fl">
								<img src={{ i.get_Gcolor.colorurl }} width="87px" height="87px">
							</li>
							<li class="fl">
								<p>{{ i.get_Goods.gname }}</p>
								<p>颜色分类：{{ i.get_Gcolor.colorname }}</p>
								<p>数量：{{ i.count }}</p>
							</li>
							<li class="fr price_ unit_price" >{{ i.get_Goods.price|sum_price:i.count }}</li>
						</ul>
                        {% endfor %}
                    {% endif %}





					</div>
					<!--------tips---------------->
					<div class="tips">
						<p><span class="fl">商品金额：</span><span class="fr" id="sumprice"></span></p>
						<p><span class="fl">优惠金额：</span><span class="fr price_" id="off_price">0.00</span></p>
						<p><span class="fl">运费：</span><span class="fr" id="fare">免运费</span></p>
					</div>
					<!--------tips count---------------->
					<div class="count tips">
						<p><span class="fl">合计：</span><span class="fr price_" id="total"></span></p>
					</div>
					<!--<input type="button" name="" value="去支付"> -->
					<a href="http://127.0.0.1:8000/order/order.html" id="pay" class="pay" onclick="javascript:void(0);">去支付</a>
				</div>
			</div>
		</div>
{% endblock %}


{% block footerjs %}
    <script src="/static/public.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/pro.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/user.js" type="text/javascript" charset="utf-8"></script>
    <script>
        let sum_num = 0;
        $.each($(".unit_price"), function (index ,pri) {
            sum_num += Number(pri.innerText)
            console.log(sum_num)
        })
        $("#sumprice").text(sum_num)
        $("#total").text($("#sumprice").text())
    </script>
    <script>
        $("#pay").click(function(){
            let cartitems = []

            $.each($('.msg ul'),function(index,item){
                cartitems.push({"goodsid":Number($(item).attr('goodsid')),
                                "sizeid":Number($(item).attr('sizeid')),
                                "colorid":Number($(item).attr('colorid')),
                                "count":Number($(item).attr('count'))
                                })

            })
            let total = $("#total").text()
            console.log('0000', total)

            //拼接请求参数
            let params = 'address={{ addr.id }}&payway='+$('.way .on').attr('name')+'&cartitems='+JSON.stringify(cartitems)+'&tp='+total

            //拼接请求地址
            let url = '/order/toorder/?'+params

            $(this).attr('href',url)

        })


    </script>
{% endblock %}